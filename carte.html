<!DOCTYPE html>
<meta charset="UTF-8">
<html>
    <head>
        <style>
            /* Always set the map height explicitly to define the size of the div
            * element that contains the map. */
            #map {
                height: 90%;
            }
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
            var map;

            function mapInitialisation() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 2,
                    minZoom: 2,
                    restriction: {
                        latLngBounds: {
                                north: 85,
                                south: -85,
                                west: -85,
                                east: 85,
                            },
                        strictBounds: false },
                    center: {lat: 47, lng: 2.8},
                    mapTypeId: 'terrain',
                    disableDefaultUI: true
                });

                loadEarthquakeLayer("2014-01-01", undefined, 1, 2, undefined, undefined, undefined, 10);

                map.data.setStyle(function(feature) {
                    return {
                        icon: getCircle(feature.getProperty('mag'))
                    };
                });
            }

            function loadEarthquakeLayer(start = null, end = null, min = null, max = null, lat = null, lng = null, rad = null, limit = 100) {
                var query = 'https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&jsonerror=true';
                query += '&limit=' + limit;
                if (start)
                    query += '&starttime=' + start;
                if (end)
                    query += '&endtime=' + end;
                if (min)
                    query += '&minmagnitude=' + min;
                if (max)
                    query += '&maxmagnitude=' + max;
                if (lat)
                    query += '&latitude=' + lat;
                if (lng)
                    query += '&longitude='+ lng;
                if (lat && lon && rad)
                    query += '&maxradiuskm' + rad;
                map.data.loadGeoJson(query);
            }

            function eraseLayer(dataLayer = map.data) {
                dataLayer.forEach(function(feature){map.data.remove(feature);});
            }

            function getCircle(magnitude) {
                return {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: 'darkgrey',
                    fillOpacity: .2,
                    scale: magnitude*10,
                    strokeColor: 'grey',
                    strokeWeight: .5
                };
            }

        </script>
        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvM8ENjaBYUOERtQEhlcfFGOxF8T248CE&callback=mapInitialisation&libraries=places">
        </script>
    </body>
</html>
